АВТОМАТИЗИРОВАННАЯ РАСПРЕДЕЛЕННАЯ СИСТЕМА РАСЧЕТА ЗАТРАТ ПОЧТОВЫХ МАРШРУТОВ ОТДЕЛЕНИЙ СВЯЗИ

СОДЕРЖАНИЕ:

1. Общая характеристика проекта
2. Архитектура системы
3. Структура базы данных
4. Основные функции и логика работы
5. Формулы и алгоритмы расчета
6. Интерфейсы и пользовательские функции
7. Административные функции
8. Отслеживание и история заказов
9. Заключение

1. ОБЩАЯ ХАРАКТЕРИСТИКА ПРОЕКТА

Название проекта: Автоматизированная распределенная система расчета затрат почтовых маршрутов отделений связи
Тема: Система автоматического расчета стоимости доставки посылок, писем и других отправлений через различные почтовые операторы.
Цель: Создание веб-приложения, которое позволяет пользователям рассчитывать стоимость и сроки доставки отправлений между отделениями связи различных операторов, а также оформлять и отслеживать заказы.

Технологии:
- Язык программирования: PHP
- Веб-фреймворк: HTML, CSS, JavaScript
- База данных: MySQL (через XAMPP/phpMyAdmin)
- Веб-сервер: Apache
- Сторонние библиотеки: Bootstrap, Leaflet (карты), PDO

2. АРХИТЕКТУРА СИСТЕМЫ

Структура проекта:
- index.php - главная страница (вход/регистрация)
- login.php - форма входа
- register.php - форма регистрации
- db.php - подключение к базе данных
- calculator.php - основной калькулятор доставки
- cost_calculator.php - файл с функциями расчета
- order_form.php - форма оформления заказа
- profile.php - личный кабинет пользователя
- history.php - история заказов
- track.php - отслеживание посылки
- courier_dashboard.php - панель курьера
- admin/ - административная панель
- assets/css/ - стили
- delivery_by (4).sql - файл базы данных

Система поддерживает три типа пользователей:
- Обычный пользователь (user) - может рассчитывать стоимость, оформлять заказы
- Курьер (courier) - может обрабатывать заказы, обновлять статусы
- Администратор (admin) - полный доступ ко всем функциям

3. СТРУКТУРА БАЗЫ ДАННЫХ

База данных delivery_by включает следующие таблицы:

3.1 Таблица `users`:
- id: целое число, первичный ключ, автоинкремент
- login: строка, уникальный логин пользователя
- password: строка, хешированный пароль
- full_name: строка, полное имя пользователя
- email: строка, email пользователя
- phone: строка, телефон пользователя
- role: строка, роль пользователя (user, courier, admin)
- created_at: дата и время, дата создания учетной записи

3.2 Таблица `carriers` (операторы доставки):
- id: целое число, первичный ключ, автоинкремент
- name: строка, название оператора (например, Белпочта, DPD, СДЭК)
- color: строка, цвет для отображения (HEX-код)
- max_weight: десятичное число, максимальный вес отправления
- base_cost: десятичное число, базовая стоимость доставки
- cost_per_kg: десятичное число, стоимость за килограмм
- cost_per_km: десятичное число, стоимость за километр
- speed_kmh: десятичное число, средняя скорость доставки (км/ч)
- description: текст, описание оператора

3.3 Таблица `offices` (отделения):
- id: целое число, первичный ключ, автоинкремент
- carrier_id: целое число, внешний ключ на оператора
- city: строка, город
- address: строка, адрес отделения
- lat: десятичное число, широта координаты
- lng: десятичное число, долгота координаты

3.4 Таблица `calculated_routes` (рассчитанные маршруты):
- id: целое число, первичный ключ, автоинкремент
- from_office_id: целое число, ID начального отделения
- to_office_id: целое число, ID конечного отделения
- distance_km: десятичное число, расстояние в километрах
- duration_min: целое число, продолжительность в минутах
- route_data: текст, данные маршрута (для отображения на карте)
- created_at: дата и время, дата создания записи

3.5 Таблица `orders` (заказы):
- id: целое число, первичный ключ, автоинкремент
- user_id: целое число, внешний ключ на пользователя
- carrier_id: целое число, внешний ключ на оператора
- from_office: целое число, начальное отделение
- to_office: целое число, конечное отделение
- weight: десятичное число, вес отправления
- cost: десятичное число, стоимость доставки
- delivery_hours: десятичное число, время доставки в часах
- track_number: строка, трек-номер
- created_at: дата и время, дата создания заказа
- delivery_date: дата, предполагаемая дата доставки
- payment_status: строка, статус оплаты (pending, paid)
- tracking_status: строка, статус отслеживания (created, processed, in_transit, delivered, etc.)
- full_name: строка, ФИО отправителя
- home_address: текст, домашний адрес отправителя
- pickup_city: строка, город получения
- pickup_address: текст, адрес получения
- delivery_city: строка, город доставки
- delivery_address: текст, адрес доставки
- desired_date: дата, желаемая дата доставки
- insurance: булево, страхование
- packaging: булево, упаковка
- fragile: булево, хрупкость
- payment_method: строка, метод оплаты
- cash_on_delivery: булево, наложенный платеж
- cod_amount: десятичное число, сумма наложенного платежа
- comment: текст, комментарии
- recipient_name: строка, имя получателя
- recipient_address: текст, адрес получателя
- courier_id: целое число, ID курьера

3.6 Таблица `tracking_status_history` (история статусов):
- id: целое число, первичный ключ, автоинкремент
- order_id: целое число, внешний ключ на заказ
- status: строка, статус заказа
- timestamp: дата и время, время изменения статуса
- comment: текст, комментарий к статусу

3.7 Таблица `courier_stats` (статистика курьеров):
- id: целое число, первичный ключ, автоинкремент
- courier_id: целое число, ID курьера
- date: дата, дата статистики
- orders_delivered: целое число, количество доставленных заказов
- distance_km: десятичное число, пройденное расстояние
- working_hours: десятичное число, отработанные часы

4. ОСНОВНЫЕ ФУНКЦИИ И ЛОГИКА РАБОТЫ

4.1 Функция getRouteBetweenOffices($db, $from_office_id, $to_office_id):
Проверяет наличие готового маршрута в таблице calculated_routes и возвращает информацию о расстоянии, продолжительности и данных маршрута.

4.2 Функция getOfficesByCarrier($db, $carrier_id):
Возвращает список отделений для выбранного оператора доставки.

4.3 Функция calculateDeliveryCost($db, $carrier_id, $from_office_id, $to_office_id, $weight, $package_type, $insurance, $letter_count = 1, $packaging = false, $fragile = false, $with_breakdown = false, $cash_on_delivery_amount = 0):
Универсальная функция расчета стоимости доставки, которая:
- Получает информацию об операторе
- Получает информацию о маршруте
- Рассчитывает приблизительное расстояние с использованием формулы Хаверсина, если маршрут не найден
- Применяет различные коэффициенты и надбавки
- Возвращает общую стоимость и расстояние

4.4 Функция formatDeliveryTime($hours):
Преобразует время доставки в часах в понятный формат (менее суток, 1-1.5 дня и т.д.).

4.5 Логика выбора оператора:
- Пользователь выбирает оператора доставки из списка
- Система отображает информацию об операторе (цвет, максимальный вес)
- После выбора оператора становится доступна форма расчета

4.6 Логика выбора отделений:
- Пользователь может искать отделения для отправки и получения
- Система предоставляет возможность выбрать ближайшее отделение
- После выбора обоих отделений можно рассчитать маршрут на карте

4.7 Логика расчета стоимости:
- Пользователь выбирает тип отправления (посылка/письмо)
- Вводит вес или количество писем
- Выбирает дополнительные услуги (страховка, упаковка, хрупкость)
- Система динамически пересчитывает стоимость

5. ФОРМУЛЫ И АЛГОРИТМЫ РАСЧЕТА

5.1 Формула Хаверсина (для расчета расстояния между двумя точками на сфере):
Формула используется для приблизительного расчета расстояния между двумя отделениями по их координатам:

a = sin²(Δφ/2) + cos φ1 ⋅ cos φ2 ⋅ sin²(Δλ/2)
c = 2 ⋅ atan2( √a, √(1−a) )
d = R ⋅ c

Где:
- φ - широта в радианах
- λ - долгота в радианах
- R - радиус Земли (6371 км)
- Δφ - разница широт
- Δλ - разница долгот

Реализация в коде:
$lat1 = deg2rad($from_office_data['lat']);
$lon1 = deg2rad($from_office_data['lng']);
$lat2 = deg2rad($to_office_data['lat']);
$lon2 = deg2rad($to_office_data['lng']);

$delta_lat = $lat2 - $lat1;
$delta_lon = $lon2 - $lon1;

$a = sin($delta_lat / 2) * sin($delta_lat / 2) + 
     cos($lat1) * cos($lat2) * 
     sin($delta_lon / 2) * sin($delta_lon / 2);
$c = 2 * atan2(sqrt($a), sqrt(1 - $a));

$distance = 6371 * $c; // Earth's radius in km

5.2 Формула расчета стоимости доставки:
$base_cost = $carrier['base_cost']; // Базовая стоимость
$weight_cost = $weight * $carrier['cost_per_kg']; // Стоимость за вес
$distance_cost = $distance * $carrier['cost_per_km']; // Стоимость за расстояние
$cod_cost = ($cash_on_delivery_amount > 0) ? $cash_on_delivery_amount * 0.05 : 0; // Стоимость наложенного платежа

$cost = $base_cost + $weight_cost + $distance_cost + $cod_cost;

// Применение надбавок:
// Надбавка за страховку (2% от текущей стоимости)
if ($insurance) {
    $insurance_cost = $cost * 0.02;
    $cost += $insurance_cost;
}

// Надбавка за упаковку (3 BYN)
if ($packaging) {
    $packaging_cost = 3.00;
    $cost += $packaging_cost;
}

// Надбавка за хрупкость (1% от текущей стоимости)
if ($fragile) {
    $fragile_cost = $cost * 0.01;
    $cost += $fragile_cost;
}

// Применение минимальной стоимости для писем
if ($package_type === 'letter') {
    $cost = max($cost, 2.5);
}

$cost = round($cost, 2);

5.3 Расчет времени доставки:
$duration_min = $routeData['duration_min']; // Продолжительность в минутах из базы данных
$base_hours = $duration_min / 60; // Преобразование минут в часы
$hours = round($base_hours, 1); // Округление до 1 знака после запятой

5.4 Расчет веса для писем:
$weight = $letter_count * 0.02; // Вес одного письма 0.02 кг

6. ИНТЕРФЕЙСЫ И ПОЛЬЗОВАТЕЛЬСКИЕ ФУНКЦИИ

6.1 Главная страница (index.php):
- Отображает кнопки "Войти" и "Регистрация"
- Показывает информацию о системе
- Проверяет авторизацию пользователя и перенаправляет на калькулятор

6.2 Регистрация (register.php):
- Позволяет пользователю создать учетную запись
- Проверяет уникальность логина
- Хеширует пароль перед сохранением

6.3 Вход (login.php):
- Проверяет логин и пароль
- Создает сессию пользователя
- Перенаправляет на соответствующую страницу в зависимости от роли

6.4 Калькулятор (calculator.php):
- Выбор оператора доставки
- Выбор начального и конечного отделения
- Показ маршрута на карте
- Выбор типа отправления
- Ввод веса или количества писем
- Выбор дополнительных услуг
- Динамический расчет стоимости
- Переход к оформлению заказа

6.5 Профиль (profile.php):
- Просмотр личной информации
- Возможность изменения данных
- Статистика пользователя

6.6 История заказов (history.php):
- Просмотр всех заказов пользователя
- Статусы заказов
- Детали каждого заказа
- Возможность отслеживания

6.7 Отслеживание (track.php):
- Ввод трек-номера
- Просмотр статуса заказа
- История изменений статуса

6.8 Форма заказа (order_form.php):
- Ввод данных отправителя и получателя
- Подтверждение параметров доставки
- Выбор метода оплаты
- Оформление заказа

6.9 Оплата (payment.php):
- Обработка оплаты
- Генерация трек-номера
- Обновление статуса заказа

7. АДМИНИСТРАТИВНЫЕ ФУНКЦИИ

7.1 Административная панель (admin/):
- Управление операторами доставки
- Управление отделениями
- Управление пользователями
- Просмотр всех заказов
- Управление статусами заказов

7.2 Страница маршрутов (admin/routes.php):
- Просмотр и редактирование маршрутов
- Добавление новых маршрутов
- Управление данными о расстоянии и времени

8. ОТСЛЕЖИВАНИЕ И ИСТОРИЯ ЗАКАЗОВ

8.1 Статусы заказов:
- created: заказ создан
- processed: заказ обработан
- in_transit: в пути
- out_for_delivery: доставляется
- delivered: доставлен
- returned: возвращен
- cancelled: отменен
- delayed: задержан

8.2 История статусов:
- Каждое изменение статуса сохраняется в tracking_status_history
- Включает дату и время изменения
- Может содержать комментарии

8.3 Панель курьера (courier_dashboard.php):
- Просмотр назначенных заказов
- Обновление статусов заказов
- Ведение статистики работы
- Возможность добавления комментариев к заказам

9. ЗАКЛЮЧЕНИЕ

Созданная автоматизированная система расчета затрат почтовых маршрутов представляет собой полнофункциональное веб-приложение, которое:

- Обеспечивает автоматический расчет стоимости доставки с учетом различных факторов (вес, расстояние, тип отправления, дополнительные услуги)
- Использует географические данные и формулу Хаверсина для приблизительного расчета расстояний
- Поддерживает работу с несколькими операторами доставки
- Обеспечивает удобное отслеживание заказов
- Предоставляет разные уровни доступа для пользователей
- Имеет адаптивный интерфейс, работающий на различных устройствах
- Включает систему аутентификации и авторизации
- Обеспечивает хранение истории заказов и статусов
- Поддерживает генерацию отчетов и PDF-документов

Система может быть расширена дополнительными функциями, такими как интеграция с реальными API операторов доставки, более точные алгоритмы расчета маршрутов, улучшенная система статистики и аналитики, а также мобильное приложение.