# Система доставки по Беларуси с интеграцией карт

## Описание

Полнофункциональная система доставки по Беларуси с интеграцией интерактивных карт для динамического построения реальных маршрутов между почтовыми отделениями. Система работает локально на XAMPP без необходимости аренды серверов или хостинга.

## Особенности

- Интерактивные карты с Leaflet.js
- Реальные маршруты по дорогам (не прямые линии)
- Поддержка 6 операторов доставки (Белпочта, DPD, CDEK, Европочта, Boxberry, Autolight Express)
- 600+ реальных отделений по всей Беларуси
- Динамический расчет расстояния, времени и стоимости доставки
- Фильтрация отделений по операторам
- Поиск отделений на карте
- Визуализация маршрутов на карте

## Требования

- XAMPP (Apache, MySQL, PHP)
- Браузер с поддержкой JavaScript
- Доступ к интернету (для загрузки карт OpenStreetMap и API-запросов)

## Установка

1. Установите XAMPP и запустите Apache и MySQL
2. Скопируйте все файлы в папку htdocs (например, в папку `delivery_by`)
3. Откройте phpMyAdmin и создайте новую базу данных (например, `delivery_by`)
4. Импортируйте основную схему базы данных из файла `delivery_by.sql`
5. Замените старые данные отделений новыми реальными данными:

```sql
-- Удалите старые данные и добавьте новые реальные отделения
DELETE FROM offices;
-- Затем выполните INSERT-запросы из файла add_real_offices.sql
```

6. Создайте файл `db.php` с настройками подключения к базе данных:

```php
<?php
$host = 'localhost';
$dbname = 'delivery_by';
$username = 'root';
$password = ''; // или ваш пароль от MySQL

try {
    $db = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch(PDOException $e) {
    die("Connection failed: " . $e->getMessage());
}
?>
```

## Использование

1. Откройте в браузере `http://localhost/delivery_by/index_map.php`
2. Выберите перевозчика из выпадающего списка
3. На карте автоматически появятся отделения выбранного перевозчика
4. Выберите отделение отправления (отмечается буквой "A")
5. Выберите отделение получения (отмечается буквой "B")
6. Система автоматически рассчитает маршрут, расстояние и стоимость
7. Введите вес посылки для перерасчета стоимости
8. Заполните остальные поля и оформите заказ

## Структура файлов

- `index_map.php` - Главная страница
- `calculator_map.php` - Калькулятор доставки с картой
- `order_form_map.php` - Форма оформления заказа с картой
- `process_order_map.php` - Обработка заказа
- `get_offices_by_carrier.php` - Получение отделений по перевозчику
- `calculate_real_route.php` - Расчет маршрута
- `geocode.php` - Геокодирование адресов
- `add_real_offices.sql` - SQL-скрипт для добавления реальных отделений

## Интеграция с маршрутизацией

Для получения реальных маршрутов по дорогам, система может быть интегрирована с:

1. **OSRM (Open Source Routing Machine)** - локальный сервер маршрутизации
2. **OpenRouteService** - облачный API маршрутизации
3. **GraphHopper** - альтернативный сервер маршрутизации

### Установка локального OSRM

1. Скачайте данные Беларуси в формате PBF:
   - https://download.geofabrik.de/europe/belarus.html
2. Установите OSRM:
   ```bash
   npm install -g osrm
   ```
3. Подготовьте данные:
   ```bash
   osrm-extract belarus-latest.osm.pbf -p osrm-backend/profiles/car.lua
   osrm-partition belarus-latest.osrm
   osrm-customize belarus-latest.osrm
   ```
4. Запустите сервер:
   ```bash
   osrm-routed --algorithm mld belarus-latest.osrm
   ```
5. Обновите файл `calculate_real_route.php`, чтобы использовать локальный сервер:
   ```php
   $osrmUrl = "http://localhost:5000/route/v1/driving/{$fromLng},{$fromLat};{$toLng},{$toLat}?overview=full&steps=true";
   ```

## Безопасность

- Система использует подготовленные выражения для защиты от SQL-инъекций
- Все пользовательские данные экранируются перед выводом
- Рекомендуется использовать HTTPS в продакшене

## Лицензия

Проект использует открытые данные OpenStreetMap и бесплатные API-сервисы. Все исходные коды проекта могут быть использованы в образовательных целях.

## Разработка

Для улучшения системы можно:

1. Добавить кэширование маршрутов
2. Реализовать оптимизацию маршрутов для нескольких точек
3. Добавить поддержку альтернативных маршрутов
4. Внедрить систему отслеживания посылок
5. Добавить мобильную адаптацию